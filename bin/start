#!/bin/sh -ex

DIR=/btsync/
$DIR/btsync --config $DIR/data/config.json

PELICAN_INPUT=$DIR/data/mycode/content
PELICAN_OUTPUT=$DIR/data/mycode/output
NGINXDIR=/usr/share/nginx/html
rm -rf $NGINXDIR
ln -s $PELICAN_OUTPUT $NGINXDIR
nginx

cd $DIR/data/mycode
while true; do
    inotifywait -r $DIR/data/mycode
    make html || true
done
