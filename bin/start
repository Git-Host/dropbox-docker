#!/bin/sh -ex

ln -sf /data-init/.dropbox-dist .
ln -sf /data-init/bin .

# setup nginx
PELICAN_INPUT=~/Dropbox/Pelican/content
PELICAN_OUTPUT=~/Dropbox/Pelican/output
NGINXDIR=/usr/share/nginx/html
rm -rf $NGINXDIR
ln -s $PELICAN_OUTPUT $NGINXDIR
chmod a+rx ~/Dropbox/  # yup, for nginx
nginx


# Launch dropbox
~/.dropbox-dist/dropboxd &


cd ~/Dropbox/Pelican
while true; do
    inotifywait -r `pwd`/content
    make html || true
done
